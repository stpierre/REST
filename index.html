<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>Writing and consuming REST services</title>

    <link rel="stylesheet" href="css/reveal.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="css/theme/solarized.css" id="theme"/>

    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css"/>

    <link rel="stylesheet" href="local/presentation.css"/>

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>

    <!--[if lt IE 9]>
	<script src="lib/js/html5shiv.js"></script>
	<![endif]-->
  </head>

  <body>
    <div class="reveal">
      <div class="slides">
        <section id="title">
          <h2>Writing and consuming REST services</h2>

          <p><small>Chris St. Pierre
              - <a target="_blank" href="http://twitter.com/chris_st_pierre">@chris_st_pierre</a></small></p>

          <h3>Follow along at
              <a target="_blank" href="https://stpierre.github.io/REST/">stpierre.github.io/REST/</a></h3>
        </section>

        <section id="what-is-rest">
          <p class="acronym"><b>RE</b>presentational<br/>
            <b>S</b>tate<br/>
            <b>T</b>ransfer</p>

          <aside class="notes">
            <ul>
              <li>Acronym tells you nothing</li>
              <li>a way to expose remote APIs over HTTP(S)</li>
            </ul>
          </aside>
        </section>

        <section id="wait-but-why">
          <p>But <i>why?</i></p>

          <aside class="notes">
            <p>Why is obvious for app engineers, maybe not for
              sysadmins</p>

            <p>Ever wanted to expose limited functionality (not full
              shell) from one machine to another?</p>
          </aside>
        </section>

        <section id="api">
          <pre class="wide"><code data-trim>
import sandwiches

sandwiches.make_me_a_sandwich("ham")
          </code></pre>

          <aside class="notes">
            <ul>
              <li>From another host?</li>
              <li>writing your own protocol is hard</li>
              <li>full-featured even harder</li>
            </ul>
          </aside>
        </section>

        <section id="rest-api">
          <pre class="wide"><code class="bash" data-trim>
curl -X POST -d '{"type": "ham"}' \
    https://sandwiches.example.com/sandwiches
          </code></pre>

          <aside class="notes">
            <p>HTTP gives lots of stuff for free: transport, also
              encryption, authentication and authorization, proxies,
              load balancing,...</p>
          </aside>
        </section>

        <section id="good-rest-apis">
          <div class="tooltip-buttons">
            <button class="worst-practice" data-toggle="tooltip"
                    title="Click on this symbol for details about how bad REST APIs sometimes work!"></button>
          </div>

          <h3>Let's talk about <i>good</i> REST APIs.</h3>

          <aside class="notes">
            <p>lots of bad ways to write bad APIs</p>

            <p>RFCs are new, lots of SHOULDs</p>

            <p>rely on docs, glhf</p>
          </aside>
        </section>

        <section id="practical-rest-apis">
          <div class="tooltip-buttons">
            <button class="academic" data-toggle="tooltip"
                  title="Click on this symbol for a little note about the academic details or underpinnings of REST.<br/><br/>For instance, for a little light reading check out <a href='http://www.ics.uci.edu/~fielding/pubs/dissertation/fielding_dissertation.pdf'>Roy Fielding's dissertation on REST</a>."></button>
          </div>

          <h3>Let's talk about <i>practical</i> REST APIs.</h3>

          <aside class="notes">
            super academic -- e.g., HTTP
          </aside>
        </section>

        <section id="liberal-rest-apis">
          <div class="tooltip-buttons">
            <button class="holy-war" data-toggle="tooltip"
                    title="Click on this symbol for a bona fide holy war!"></button>
          </div>

          <h3>Let's be liberal in what we accept.</h3>

          <aside class="notes">
            no holy wars
          </aside>
        </section>

        <section id="soap-and-xml-rpc">
          <div class="tooltip-buttons">
            <button class="academic" data-toggle="tooltip"
                    title="<a target='_blank' href='https://github.com/stpierre/REST/blob/gh-pages/xml-rpc-drawbacks.rst'>Some problems with XML-RPC</a>"></button>
          </div>

          <h2>What about SOAP and XML-RPC?</h2>

          <aside class="notes">
            <ul>
              <li>Serve similar</li>
              <li>SOAP: super complex, never really caught on</li>
              <li>XML-RPC: simpler, drawbacks.</li>
            </ul>
          </aside>
        </section>
        <section id="verbs-and-resources">
          <div class="tooltip-buttons">
            <button class="academic" data-toggle="tooltip"
                    title="The technically correct terms are 'verbs' and 'resources,' but in HTTP REST APIs you will commonly hear 'methods' and 'endpoints' used interchangeably. Occasionally the signifier even becomes the signified and someone will use 'URI' to mean 'resource.'"></button>
          </div>

          <h3>Verbs (or methods) and<br>resources (or endpoints)</h3>

          <aside class="notes">
            what you're doing, what you're doing it to
          </aside>
        </section>

        <section id="verbs-and-endpoints-example">
          <pre class="wide"><code class="http" data-trim>
              GET http://example.com/v1/pets/ HTTP/1.0
            </code><code class="json" data-trim>
{
  "pets": [
    {
      "id": "a8533344-6371-4982-a86b-722331839514",
      "links": [
        {
          "href": "/v1/pets/a8533344-6371-4982-a86b-722331839514",
          "rel": "self"
        }
      ]
    },
    {
      "id": "00182d56-9981-402b-821e-7b1c2906533c",
      "links": [
        {
          "href": "/v1/pets/00182d56-9981-402b-821e-7b1c2906533c",
          "rel": "self"
        }
      ]
    },
    {
      "id": "18e1588a-090e-4ace-94c2-f289617de0cb",
      "links": [...]
    },
    {
      "id": "4dc4d7b0-a386-4919-9878-47d4eb8f49ec",
      "links": [...]
    },
    {
      "id": "bf61616c-010e-48f2-8173-78b330804cd6",
      "links": [...]
    },
    {
      "id": "d25dcdd0-28f4-4fd3-9e5f-da1d9d224940",
      "links": [...]
    },
    {
      "id": "72f12e94-33ca-4537-9897-205ffe42350e",
      "links": [...]
    }
  ]
}
          </code></pre>
        </section>

        <section id="verbs-get">
          <h2>GET</h2>
          <h3>List/read</h3>

          <aside class="notes">
            collections and records
          </aside>
        </section>

        <section id="get-collection-example">
          <pre class="wide"><code class="bash" data-trim>
              $ curl http://example.com/v1/owners/
            </code><code class="json" data-trim>
{
  "owners": [
    {
      "id": "511363b2-8693-4b30-ae4c-09964a4cebe0",
      "links": [
        {
          "href": "/v1/owners/511363b2-8693-4b30-ae4c-09964a4cebe0",
          "rel": "self"
        }
      ]
    },
    {
      "id": "ee5479d6-7070-4109-bfb2-d44e3c42782b",
      "links": [...]
    },
    {
      "id": "35a85559-dc03-4aa2-85d2-947e17e310e5",
      "links": [...]
    },
    {
      "id": "5e174bc4-4135-4e7b-b957-9705bacc903d",
      "links": [...]
    }
  ]
}
          </code></pre>
        </section>

        <section id="get-resource-example">
          <pre class="wide"><code class="bash" data-trim>
$ curl http://example.com/v1/owners/511363b2-8693-4b30-ae4c-09964a4cebe0
            </code><code class="json" data-trim>
{
  "id": "511363b2-8693-4b30-ae4c-09964a4cebe0",
  "name": "Goran Shain",
  "birthday": "1981-10-27",
  "shoe_size": 10.5,
  "pets": [
    "a8533344-6371-4982-a86b-722331839514",
    "d25dcdd0-28f4-4fd3-9e5f-da1d9d224940"
  ],
  "links": [
    {
      "href": "/v1/owners/511363b2-8693-4b30-ae4c-09964a4cebe0",
      "rel": "self"
    },
    {
      "href": "/v1/pets/a8533344-6371-4982-a86b-722331839514",
      "rel": "pet"
    },
    {
      "href": "/v1/pets/d25dcdd0-28f4-4fd3-9e5f-da1d9d224940",
      "rel": "pet"
    }
  ]
}
          </code></pre>
        </section>

        <section id="get-collection-querystring-example">
          <pre class="wide"><code class="bash" data-trim>
              $ curl http://example.com/v1/owners/\?limit=1\&amp;detail=1
            </code><code class="json" data-trim>
{
  "owners": [
    {
      "id": "511363b2-8693-4b30-ae4c-09964a4cebe0",
      "name": "Goran Shain",
      "birthday": "1981-10-27",
      "shoe_size": 10.5,
      "pets": [
        "a8533344-6371-4982-a86b-722331839514",
        "d25dcdd0-28f4-4fd3-9e5f-da1d9d224940"
      ],
      "links": [
        {
          "href": "/v1/owners/511363b2-8693-4b30-ae4c-09964a4cebe0",
          "rel": "self"
        },
        {
          "href": "/v1/pets/a8533344-6371-4982-a86b-722331839514",
          "rel": "pet"
        },
        {
          "href": "/v1/pets/d25dcdd0-28f4-4fd3-9e5f-da1d9d224940",
          "rel": "pet"
        }
      ]
    }
  ]
}
          </code></pre>

          <aside class="notes">
            <ul>
              <li>pass params</li>
              <li>limit and detail can make some operations much
                faster</li>
            </ul>
          </aside>
        </section>

        <section id="uri-structure">
          <div class="tooltip-buttons">
            <button class="academic" data-toggle="tooltip"
                    title="Technically, REST just uses <i>identifiers</i>, and those identifiers can be anything. But since every REST API you're likely to care about uses HTTP, and every decent HTTP REST API uses URIs as identifiers, we're just going to talk about URIs here."></button>

            <button class="holy-war" data-toggle="tooltip"
                    title="Most people agree that the resource name should be plural, but there's a significant contingent of singular partisans, and even some people who think your application should support both."></button>
          </div>

          <pre class="wide">/v1/owners/511363b2-8693-4b30-ae4c-09964a4cebe0</pre>

          <pre class="wide">/v1/owners/511363b2-8693-4b30-ae4c-09964a4cebe0/pets/?limit=5</pre>

          <pre class="wide">/v1/servers/b8060d42-8a2c-4f38-8ffb-b1b749e7a50a/reboot</pre>

          <!-- TODO: highlight bits of these -- maybe tooltips? -->

          <aside class="notes">
            version, resource, id

            <p>might have other stuff after the id -- actions,
              subcollections, etc.</p>

            <p>versions are full reimplementations</p>
          </aside>
        </section>

        <section id="links">
          <div class="tooltip-buttons">
            <button class="holy-war" data-toggle="tooltip"
                  title="Detractors point out that including all of these links can substantially increase response size, and they're right. I've included them because it seems to be the general consensus Right Thingâ„¢ to do, but it doesn't always make sense."></button>
          </div>

          <pre class="wide"><code class="bash" data-trim>
              $ curl http://example.com/v1/owners/
            </code><code class="json" data-trim>
{
  "owners": [
    {
      "id": "511363b2-8693-4b30-ae4c-09964a4cebe0",
      "links": [
        {
          "href": "/v1/owners/511363b2-8693-4b30-ae4c-09964a4cebe0",
          "rel": "self"
        }
      ]
    },
    {
      "id": "ee5479d6-7070-4109-bfb2-d44e3c42782b",
      "links": [
        {
          "href": "/v1/owners/ee5479d6-7070-4109-bfb2-d44e3c42782b",
          "rel": "self"
        }
      ]
    },
    {
      "id": "35a85559-dc03-4aa2-85d2-947e17e310e5",
      "links": [
        {
          "href": "/v1/owners/35a85559-dc03-4aa2-85d2-947e17e310e5",
          "rel": "self"
        }
      ]
    },
    {
      "id": "5e174bc4-4135-4e7b-b957-9705bacc903d",
      "links": [
        {
          "href": "/v1/owners/5e174bc4-4135-4e7b-b957-9705bacc903d",
          "rel": "self"
        }
      ]
    }
  ]
}
          </code></pre>

          <aside class="notes">
            <ul>
              <li>discoverability</li>
              <li>super academic at times</li>
              <li>NTH, but literally every single client is going
                to use your docs anyway</li>
            </ul>
          </aside>
        </section>

        <section id="without-links">
          <pre class="wide"><code class="bash" data-trim>
              $ curl http://example.com/v1/owners/
            </code><code class="json" data-trim>
{
  "owners": [
    "511363b2-8693-4b30-ae4c-09964a4cebe0",
    "ee5479d6-7070-4109-bfb2-d44e3c42782b",
    "35a85559-dc03-4aa2-85d2-947e17e310e5",
    "5e174bc4-4135-4e7b-b957-9705bacc903d"
  ]
}
          </code></pre>

          <aside class="notes">
            <p>holy smaller, batman</p>
            <p>three times smaller</p>
          </aside>
        </section>

        <section id="links2">
          <div class="tooltip-buttons">
            <button class="academic" data-toggle="tooltip"
                    title="<a target='_blank'
                    href='https://tools.ietf.org/html/rfc5988'>RFC5988</a> even proposes a Link header, in part to clean up some of this mess. I've never seen an application that relies on it or even mentions it in documentation as an option, which is probably an indicator of how valuable some of this linking stuff is."></button>
          </div>

          <pre class="wide"><code class="bash" data-trim>
$ curl http://example.com/v1/owners/ee5479d6-7070-4109-bfb2-d44e3c42782b
            </code><code class="json" data-trim>
{
  "id": "ee5479d6-7070-4109-bfb2-d44e3c42782b",
  "name": "Remus Bergfalk",
  "birthday": "1977-05-08",
  "shoe_size": 9.5,
  "pets": [
    "00182d56-9981-402b-821e-7b1c2906533c",
    "72f12e94-33ca-4537-9897-205ffe42350e"
  ],
  "links": [
    {
      "href": "/v1/owners/ee5479d6-7070-4109-bfb2-d44e3c42782b",
      "rel": "self"
    },
    {
      "href": "/v1/pets/00182d56-9981-402b-821e-7b1c2906533c",
      "rel": "pet"
    },
    {
      "href": "/v1/pets/72f12e94-33ca-4537-9897-205ffe42350e",
      "rel": "pet"
    }
  ]
}
            </code></pre>
        </section>

        <section id="yo-dawg-we-heard-you-liked-links">
          <div class="tooltip-buttons">
            <button class="academic" data-toggle="tooltip"
                    title="In theory, the only documentation the end user should ever need is the base entry point into your application. In practice, every application needs lots of documentation, and REST purists can just get over their irrational fear of coupling. Use a good automatic docs generator."></button>
          </div>

          <pre class="wide"><code class="bash" data-trim>
$ curl http://example.com/v2/owners/ee5479d6-7070-4109-bfb2-d44e3c42782b
            </code><code class="json" data-trim>
{
  "owner": {
    "id": "ee5479d6-7070-4109-bfb2-d44e3c42782b",
    "name": "Remus Bergfalk",
    "birthday": "1977-05-08",
    "shoe_size": 9.5,
    "pets": [
      "00182d56-9981-402b-821e-7b1c2906533c",
      "72f12e94-33ca-4537-9897-205ffe42350e"
    ],
    "links": [
      {
        "href": "/v2/owners/ee5479d6-7070-4109-bfb2-d44e3c42782b",
        "method": "GET",
        "rel": "self"
      },
      {
        "href": "/v2/pets/00182d56-9981-402b-821e-7b1c2906533c",
        "method": "GET",
        "rel": "pet"
      },
      {
        "href": "/v2/pets/72f12e94-33ca-4537-9897-205ffe42350e",
        "method": "GET",
        "rel": "pet"
      },
      {
        "href": "/v2/owners/ee5479d6-7070-4109-bfb2-d44e3c42782b",
        "method": "PUT",
        "rel": "edit"
      },
      {
        "href": "/v2/owners/ee5479d6-7070-4109-bfb2-d44e3c42782b",
        "method": "DELETE",
        "rel": "delete"
      }
    ],
  },
  "links": [
    {
      "href": "/v2/owners/",
      "method": "GET",
      "rel": "list"
    },
    {
      "href": "/v2/owners/",
      "method": "POST",
      "rel": "create"
    }
  ]
}
          </code></pre>

          <aside class="notes">
            links can get out of hand
          </aside>
        </section>

        <section id="HATEOAS">
          <div class="tooltip-buttons">
            <button class="holy-war" data-toggle="tooltip"
                  title="People get <i>really</i> worked up over HATEOAS. Jeff Knupp even <a target='_blank' href='https://jeffknupp.com/blog/2014/06/03/why-i-hate-hateoas/'>specifically calls out Fielding for his over-the-top purism</a>. I tend to side with Knupp."></button>
          </div>

          <p class="acronym"><b>H</b>ypertext<br/>
            <b>A</b>s<br/>
            <b>T</b>he<br/>
            <b>E</b>ngine<br/>
            <b>O</b>f<br/>
            <b>A</b>pplication<br/>
            <b>S</b>tate</p>

          <aside class="notes">
            <p>Basically, "use lots of links."</p>

            <p>important to understand, but left out in remainder of preso</p>
          </aside>
        </section>

        <section id="verbs-head">
          <h2>HEAD</h2>
          <h3>Check existence</h3>
        </section>

        <section id="head-example">
          <pre class="wide"><code class="bash" data-trim>
$ curl -X HEAD \
   http://example.com/v1/owners/511363b2-8693-4b30-ae4c-09964a4cebe0
            </code><code class="nohilight" data-trim>
              # HTTP code: 200
          </code></pre>
        </section>

        <section id="head-404-example">
          <pre class="wide"><code class="bash" data-trim>
$ curl -X HEAD \
   http://example.com/v1/owners/totally-bogus-owner-uuid
            </code><code class="nohilight" data-trim>
              # HTTP code: 404
          </code></pre>
        </section>


        <section id="verbs-post">
          <h2>POST</h2>
          <h3>Create</h3>

          <aside class="notes">
            Mostly create

            <p>Also actions outside of CRUD</p>
          </aside>
        </section>

        <section id="post-example">
          <pre class="wide"><code class="bash" data-trim>
$ curl -X POST -d '{"name":"Jovka Garver","birthday":"1983-02-26"}' \
    -H 'Content-Type: application/json' http://example.com/v1/owners/
            </code><code class="json" data-trim>
{
  "id": "b90a363c-d694-4e8c-be68-f53eeece2b99",
  "name": "Jovka Garver",
  "birthday": "1983-02-26",
  "pets": []
}
            </code><code class="nohilight" data-trim>
              # HTTP code: 201
          </code></pre>
        </section>

        <section id="return-values">
          <div class="tooltip-buttons">
            <button class="worst-practice" data-toggle="tooltip"
                    title="Some REST APIs, like <a target='_blank' href='https://gerrit-review.googlesource.com/Documentation/rest-api.html#output'>Gerrit's</a>, as well as many of Google's and Facebook's APIs, use a &quot;magic prefix&quot; to prevent XSS instead of just returning objects. This is super annoying, since you can't just deserialize the response like most REST libraries want to, but it can help prevent some obscure attacks."></button>
          </div>

          <pre class="wide"><code class="bash" data-trim>
              $ curl http://example.com/v1/owners/
            </code><code class="json" data-trim>
{
  "owners": [
    "511363b2-8693-4b30-ae4c-09964a4cebe0",
    "ee5479d6-7070-4109-bfb2-d44e3c42782b",
    "35a85559-dc03-4aa2-85d2-947e17e310e5",
    "5e174bc4-4135-4e7b-b957-9705bacc903d",
    "b90a363c-d694-4e8c-be68-f53eeece2b99"
  ]
}
          </code></pre>

          <aside class="notes">
            <p>created owner appears in list</p>

            <p>JSON</p>

            <p>objects not lists</p>
          </aside>
        </section>

        <section id="return-values-non-json">
          <pre class="wide"><code class="bash" data-trim>
$ curl http://someapp.example.com/v1/books/1
            </code><code class="json" data-trim>
{"title": "Moby Dick", "text": "Call me Ishmael. Some years ago...."}
          </code></pre>

          <pre class="wide"><code class="bash" data-trim>
$ curl -H "Accept: text/plain" http://someapp.example.com/v1/books/1
            </code><code class="json" data-trim>
Moby Dick

Call me Ishmael. Some years ago....
          </code></pre>

          <aside class="notes">
            more complex applications can use the Accept and
            Content-Type header to get data in different formats
          </aside>
        </section>

        <section id="return-values-gzip">
          <pre class="wide"><code class="bash" data-trim>
$ curl -H "Accept-Encoding: gzip" http://someapp.example.com/v1/books/1 | \
      gunzip -c
            </code><code class="json" data-trim>
{"title": "Moby Dick", "text": "Call me Ishmael. Some years ago...."}
          </code></pre>

          <aside class="notes">
            <p>large result sets</p>

            <p>draft rfc proposes
            encryption: <a href="http://httpwg.org/http-extensions/draft-ietf-httpbis-encryption-encoding.html">http://httpwg.org/http-extensions/draft-ietf-httpbis-encryption-encoding.html</a></p>
          </aside>
        </section>

        <section id="post-action">
          <pre class="wide"><code class="bash" data-trim>
$ curl -X POST -d '' \
    http://example.com/v1/servers/335b53b4-7b86-4a3b-976e-75f13a0a9e78/reboot
            </code><code class="nohilight" data-trim>
              # HTTP code: 204
          </code></pre>
        </section>

        <section id="verbs-put">
          <h2>PUT</h2>
          <h3>Create/update (idempotent)</h3>

          <aside class="notes">
            Mostly modify
          </aside>
        </section>

        <section id="put-modify-example-step1">
          <pre class="wide"><code class="bash" data-trim>
$ curl http://example.com/v1/owners/35a85559-dc03-4aa2-85d2-947e17e310e5
            </code><code class="json" data-trim>
{
  "id": "35a85559-dc03-4aa2-85d2-947e17e310e5",
  "name": "Jolanda Seaver",
  "birthday": "1996-08-29",
  "shoe_size": 8.5,
  "pets": [
    "18e1588a-090e-4ace-94c2-f289617de0cb",
    "4dc4d7b0-a386-4919-9878-47d4eb8f49ec"
  ]
}
          </code></pre>
        </section>

        <section id="put-modify-example-step2">
          <div class="tooltip-buttons">
            <button class="holy-war" data-toggle="tooltip"
                    title="There's no great guidance out there on whether or not foreign keys should be part of the record that gets passed to PUT. IMO, PUT should be symmetrical with POST, and I haven't made POST accept foreign keys, so I haven't made PUT do so either."></button>
          </div>

          <pre class="wide"><code class="bash" data-trim>
$ curl -X PUT \
    -d '{"name":"Jolanda Seaver","birthday":"1996-08-29","shoe_size":9}' \
    -H 'Content-Type: application/json' \
    http://example.com/v1/owners/35a85559-dc03-4aa2-85d2-947e17e310e5
            </code><code class="json" data-trim>
{
  "id": "35a85559-dc03-4aa2-85d2-947e17e310e5",
  "name": "Jolanda Seaver",
  "birthday": "1996-08-29",
  "shoe_size": 9.0,
  "pets": [
    "18e1588a-090e-4ace-94c2-f289617de0cb",
    "4dc4d7b0-a386-4919-9878-47d4eb8f49ec"
  ]
}
          </code></pre>
          <aside class="notes">
            <p>have to specify the entire record</p>
          </aside>
        </section>

        <section id="put-modify-bad-example">
          <div class="tooltip-buttons">
            <button class="worst-practice" data-toggle="tooltip"
                    title="In general, if you omit a field that can legally be omitted, it should be removed from the record. In practice, not every API is that smart, and you should check the docs and/or TIAS."></button>
          </div>

          <pre class="wide"><code class="bash" data-trim>
$ curl -X PUT -d '{"shoe_size":9}' -H 'Content-Type: application/json' \
    http://example.com/v1/owners/35a85559-dc03-4aa2-85d2-947e17e310e5
</code><code class="json" data-trim>
{"message": {"name": "Missing required parameter in the JSON body or the post body or the query string"}}
            </code><code class="nohilight" data-trim>
              # HTTP code: 400
          </code></pre>
        </section>

        <section id="put-idempotent-show-vet">
          <pre class="wide"><code class="bash" data-trim>
$ curl \
    http://example.com/v1/veterinarians/3cfbb699-d2f2-45cd-b932-be5171887262
            </code><code class="json" data-trim>
{
  "id": "3cfbb699-d2f2-45cd-b932-be5171887262",
  "name": "Seong-Min Park"
}
          </code></pre>
        </section>

        <section id="put-idempotent-show-vet-patients">
          <pre class="wide"><code class="bash" data-trim>
$ curl \
    http://example.com/v1/veterinarians/3cfbb699-d2f2-45cd-b932-be5171887262/patients/
            </code><code class="json" data-trim>
{
  "patients": [
    "00182d56-9981-402b-821e-7b1c2906533c",
  ]
}
          </code></pre>
        </section>

        <section id="put-idempotent-do-put">
          <pre class="wide"><code class="bash" data-trim>
$ curl -X PUT \
    http://example.com/v1/veterinarians/3cfbb699-d2f2-45cd-b932-be5171887262/patients/d25dcdd0-28f4-4fd3-9e5f-da1d9d224940
            </code><code class="json" data-trim>
{
  "patient": {
    "id": "d25dcdd0-28f4-4fd3-9e5f-da1d9d224940"
  },
  "veterinarian": {
    "id": "3cfbb699-d2f2-45cd-b932-be5171887262"
  }
}
            </code><code class="nohilight" data-trim>
              # HTTP code: 201
            </code></pre>
        </section>

        <section id="put-idempotent-show-vet-patients-after">
          <pre class="wide"><code class="bash" data-trim>
$ curl \
    http://example.com/v1/veterinarians/3cfbb699-d2f2-45cd-b932-be5171887262/patients/
            </code><code class="json" data-trim>
{
  "patients": [
    "00182d56-9981-402b-821e-7b1c2906533c",
    "d25dcdd0-28f4-4fd3-9e5f-da1d9d224940"
  ]
}
          </code></pre>
        </section>

        <section id="put-demonstrate-idempotency">
          <div class="tooltip-buttons">
            <button class="worst-practice" data-toggle="tooltip"
                    title="<b>Lots</b> and lots of APIs don't implement creation via PUT. Often this is for good reasons -- like IDs that must be auto-generated -- but sometimes it's just laziness.<br/><br/><a target='_blank' href='https://gerrit-review.googlesource.com/Documentation/rest-api.html#preconditions'>Gerrit's REST API</a> implements PUT to only be idempotent if you specifically ask it to be, so clearly they know how to do the right thing but decided not to."></button>
          </div>

          <pre class="wide"><code class="bash" data-trim>
$ curl -X PUT \
    http://example.com/v1/veterinarians/3cfbb699-d2f2-45cd-b932-be5171887262/patients/d25dcdd0-28f4-4fd3-9e5f-da1d9d224940
            </code><code class="json" data-trim>
{
  "patient": {
    "id": "d25dcdd0-28f4-4fd3-9e5f-da1d9d224940"
  },
  "veterinarian": {
    "id": "3cfbb699-d2f2-45cd-b932-be5171887262"
  }
}
            </code><code class="nohilight" data-trim>
              # HTTP code: 200
            </code></pre>

          <aside class="notes">
            200 vs. 201
          </aside>
        </section>

        <section id="put-idempotent-compare-post">
          <pre class="wide"><code class="bash" data-trim>
$ curl -X POST -d '{"pet_id":"d25dcdd0-28f4-4fd3-9e5f-da1d9d224940"}' \
    -H 'Content-Type: application/json' \
    http://example.com/v1/veterinarians/3cfbb699-d2f2-45cd-b932-be5171887262/patients/
            </code><code class="json" data-trim>
              {"message": "Pet d25dcdd0-28f4-4fd3-9e5f-da1d9d224940 is already assigned to veterinarian 3cfbb699-d2f2-45cd-b932-be5171887262"}
            </code><code class="nohilight" data-trim>
              # HTTP code: 409
            </code></pre>

          <aside class="notes">
            409
          </aside>
        </section>

        <section id="relationships">
          <h2>Demonstrating Relationships</h2>
          <h3>One-to-one, one-to-many, many-to-many</h3>

          <aside class="notes">
            Only two patterns -- 1-to-1 and 1-to-N same
          </aside>
        </section>

        <section id="one-to-N-get">
          <pre class="wide"><code class="bash" data-trim>
$ curl http://example.com/v1/pets/72f12e94-33ca-4537-9897-205ffe42350e
            </code><code class="json" data-trim>
{
  "id": "72f12e94-33ca-4537-9897-205ffe42350e",
  "name": "Hellbringer the Befouler",
  "breed": "domestic shorthair",
  "veterinarian": "fd87a620-466d-41ae-a6b0-1527b5126c58",
  "species": "cat",
  "owners": [
    "ee5479d6-7070-4109-bfb2-d44e3c42782b"
  ]
}
          </code></pre>
        </section>

        <section id="one-to-N-vet-output">
          <pre class="wide"><code class="bash" data-trim>
$ curl \
    http://example.com/v1/pets/72f12e94-33ca-4537-9897-205ffe42350e/veterinarian/
            </code><code class="json" data-trim>
{
  "veterinarian": "fd87a620-466d-41ae-a6b0-1527b5126c58",
}
          </code></pre>
        </section>

        <section id="one-to-N-detail">
          <pre class="wide"><code class="bash" data-trim>
$ curl \
    http://example.com/v1/pets/72f12e94-33ca-4537-9897-205ffe42350e/veterinarian/\?detail=1
            </code><code class="json" data-trim>
{
  "veterinarian": {
    "id": "fd87a620-466d-41ae-a6b0-1527b5126c58",
    "name": "Colobert Bannerman",
    "specialty": "cats"
  }
}
          </code></pre>
        </section>

        <section id="many-to-N-get">
          <pre class="wide"><code class="bash" data-trim>
$ curl http://example.com/v1/pets/4dc4d7b0-a386-4919-9878-47d4eb8f49ec
            </code><code class="json" data-trim>
{
  "id": "4dc4d7b0-a386-4919-9878-47d4eb8f49ec",
  "name": "Scarface",
  "breed": "English Bulldog",
  "veterinarian": "f5df1cc0-4fa2-4605-af57-4da6479e8afa",
  "species": "dog",
  "owners": [
    "35a85559-dc03-4aa2-85d2-947e17e310e5",
    "5e174bc4-4135-4e7b-b957-9705bacc903d"
  ]
}
          </code></pre>
        </section>

        <section id="many-to-N-owners">
          <pre class="wide"><code class="bash" data-trim>
$ curl \
    http://example.com/v1/pets/4dc4d7b0-a386-4919-9878-47d4eb8f49ec/owners/
            </code><code class="json" data-trim>
{
  "owners": [
    "35a85559-dc03-4aa2-85d2-947e17e310e5",
    "5e174bc4-4135-4e7b-b957-9705bacc903d"
  ]
}
          </code></pre>

          <aside class="notes">
            owners are their own thing, so the subcollection is just
            convenience. but some resources only exist as part of
            another resource (e.g., servers and NICs), so only exist
            as a subcollection
          </aside>
        </section>

        <section id="first-class-relationships">
          <pre class="wide"><code class="bash" data-trim>
$ curl http://example.com/v2/ownership/5f5c1ded-32e7-4fb2-9b6f-b0aa05616d67
            </code><code class="json" data-trim>
{
  "id": "5f5c1ded-32e7-4fb2-9b6f-b0aa05616d67",
  "owner": "511363b2-8693-4b30-ae4c-09964a4cebe0",
  "pet": "a8533344-6371-4982-a86b-722331839514",
}
          </code></pre>

          <aside class="notes">
            Better for historical data.
          </aside>
        </section>

        <section id="verbs-patch">
          <h2>PATCH</h2>
          <h3>Update</h3>
        </section>

        <section id="patch-example">
          <pre class="wide"><code class="bash" data-trim>
$ curl -X PATCH -d '{"shoe_size":9.5}' -H 'Content-Type: application/json' \
    http://example.com/v1/owners/35a85559-dc03-4aa2-85d2-947e17e310e5
            </code><code class="json" data-trim>
{
  "id": "35a85559-dc03-4aa2-85d2-947e17e310e5",
  "name": "Jolanda Seaver",
  "birthday": "1996-08-29",
  "shoe_size": 9.5,
  "pets": [
    "18e1588a-090e-4ace-94c2-f289617de0cb",
    "4dc4d7b0-a386-4919-9878-47d4eb8f49ec"
  ]
}
          </code></pre>
        </section>

        <section id="patch-update-relationships-pre">
          <pre class="wide"><code class="bash" data-trim>
$ curl http://example.com/v1/pets/bf61616c-010e-48f2-8173-78b330804cd6
            </code><code class="json" data-trim>
{
  "id": "bf61616c-010e-48f2-8173-78b330804cd6",
  "name": "Kisses",
  "species": "Hissing Cockroach",
  "veterinarian": null,
  "owners": []
}
          </code></pre>
        </section>

        <section id="patch-update-relationships">
          <pre class="wide"><code class="bash" data-trim>
$ curl -X PATCH \
    -d '{"veterinarian":"3cfbb699-d2f2-45cd-b932-be5171887262","owners":["ee5479d6-7070-4109-bfb2-d44e3c42782b"]}' \
    -H 'Content-Type: application/json' \
    http://example.com/v1/pets/bf61616c-010e-48f2-8173-78b330804cd6
            </code><code class="json" data-trim>
{
  "id": "bf61616c-010e-48f2-8173-78b330804cd6",
  "name": "Kisses",
  "species": "Hissing Cockroach",
  "veterinarian": "3cfbb699-d2f2-45cd-b932-be5171887262",
  "owners": [
    "ee5479d6-7070-4109-bfb2-d44e3c42782b"
  ]
}
            </code><code class="nohilight" data-trim>
              # HTTP code: 200
          </code></pre>

          <aside class="notes">
            Modified resource is always returned
          </aside>
        </section>

        <section id="fancy-patch">
          <pre class="wide"><code class="bash" data-trim>
$ data='[
  {"node": "veterinarian",
   "op": "change",
   "value": "f5df1cc0-4fa2-4605-af57-4da6479e8afa"},
  {"node": "owner",
   "op": "delete",
   "value": "ee5479d6-7070-4109-bfb2-d44e3c42782b"}
]'
$ curl -X PATCH -d "$data" -H 'Content-Type: application/json' \
    http://example.com/v2/pets/bf61616c-010e-48f2-8173-78b330804cd6
            </code><code class="json" data-trim>
{
  "id": "bf61616c-010e-48f2-8173-78b330804cd6",
  "name": "Kisses",
  "species": "Hissing Cockroach",
  "veterinarian": "f5df1cc0-4fa2-4605-af57-4da6479e8afa",
  "owners": []
}
          </code></pre>

          <aside class="notes">
            Rarely seen in the wild

            <p>EE</p>
          </aside>
        </section>

        <section id="verbs-delete">
          <h2>DELETE</h2>
        </section>

        <section id="delete-example">
          <div class="tooltip-buttons">
            <button class="academic" data-toggle="tooltip"
                  title="<a target='_blank' href='http://blog.ploeh.dk/2013/04/30/rest-lesson-learned-avoid-204-responses/'>Some people get upset about 204s</a> because OMG LINKS! You probably already know that I think they're wrong, though."></button>
          </div>

          <pre class="wide"><code class="bash" data-trim>
$ curl -X DELETE \
    http://example.com/v1/owners/35a85559-dc03-4aa2-85d2-947e17e310e5
            </code><code class="nohilight" data-trim>
              # HTTP code: 204
          </code></pre>

          <aside class="notes">
            204
          </aside>
        </section>

        <section id="return-codes">
          <h3>Return codes</h3>

          <aside class="notes">
            Use HTTP return codes
          </aside>
        </section>

        <section id="delete-404-example">
          <div class="tooltip-buttons">
            <button class="academic" data-toggle="tooltip"
                    title="The <a target='_blank' href=&quot;http://www.restapitutorial.com/httpstatuscodes.html&quot;>full list of HTTP return codes</a>, including the ever-useful 418."></button>
          </div>

          <pre class="wide"><code class="bash" data-trim>
$ curl -X DELETE \
    http://example.com/v1/owners/35a85559-dc03-4aa2-85d2-947e17e310e5
            </code><code class="json" data-trim>
              {"message": "No such owner 35a85559-dc03-4aa2-85d2-947e17e310e5"}
            </code><code class="nohilight" data-trim>
              # HTTP code: 404
          </code></pre>
        </section>

        <section id="put-409-example">
          <pre class="wide"><code class="bash" data-trim>
$ curl -X POST -d '{"pet_id":"a8533344-6371-4982-a86b-722331839514"}' \
    -H 'Content-Type: application/json' \
    http://example.com/v1/veterinarians/f5df1cc0-4fa2-4605-af57-4da6479e8afa/patients/
            </code><code class="json" data-trim>
{"message": "Pet a8533344-6371-4982-a86b-722331839514 is already assigned to veterinarian f5df1cc0-4fa2-4605-af57-4da6479e8afa"}
            </code><code class="nohilight" data-trim>
              # HTTP code: 409
            </code></pre>
        </section>

        <section id="verb-table">
          <table>
            <thead>
              <tr>
                <th>Verb</th>
                <th>Collection operation</th>
                <th>Record operation</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>GET</td>
                <td>List</td>
                <td>Read</td>
              </tr>
              <tr>
                <td>POST</td>
                <td>Create</td>
                <td>N/A</td>
              </tr>
              <tr>
                <td>PUT</td>
                <td>N/A</td>
                <td>Update/replace (idempotent)</td>
              </tr>
              <tr>
                <td>PATCH</td>
                <td>N/A</td>
                <td>Partial update/modify</td>
              </tr>
              <tr>
                <td>DELETE</td>
                <td>Delete (rarely)</td>
                <td>Delete</td>
              </tr>
            </tbody>
          </table>
        </section>

        <section id="authentication">
          <h3>Authentication</h3>
        </section>

        <section id="auth-every-time">
          <pre class="wide"><code class="bash" data-trim>
$ curl -X DELETE \
    http://example.com/v2/owners/5e174bc4-4135-4e7b-b957-9705bacc903d
            </code><code class="json" data-trim>
{"headers": {"WWW-Authenticate": "Basic realm=\"Login Required\""}, "message": "Request requires authentication"}
            </code><code class="nohilight" data-trim>
              # HTTP code: 401
          </code></pre>

          <pre class="wide"><code class="bash" data-trim>
$ curl -X DELETE -u stpierre:hunter2 \
    http://example.com/v2/owners/5e174bc4-4135-4e7b-b957-9705bacc903d
            </code><code class="nohilight" data-trim>
              # HTTP code: 204
          </code></pre>

          <aside class="notes">
            simple! slow?
          </aside>
        </section>

        <section id="auth-token-in-header">
          <pre class="wide"><code class="bash" data-trim>
$ curl -u stpierre:hunter2 http://example.com/v1/token/
            </code><code class="json" data-trim>
{
  "token": "6158a4ff-8d50-47bd-8316-c0008b7cbc88"
}
          </code></pre>

          <pre class="wide"><code class="bash" data-trim>
$ curl -X DELETE -H 'X-Token: 6158a4ff-8d50-47bd-8316-c0008b7cbc88' \
    http://example.com/v2/pets/18e1588a-090e-4ace-94c2-f289617de0cb
            </code><code class="nohilight" data-trim>
              # HTTP code: 204
          </code></pre>

          <aside class="notes">
            more complicated

            <p>not so great actually</p>
          </aside>
        </section>

        <section id="auth-token-in-cookie">
          <pre class="wide"><code class="bash" data-trim>
$ curl -u stpierre:hunter2 -b cookies -c cookies \
    http://example.com/v2/token/
$ cat cookies
localhost	FALSE	/	FALSE	0	token	6158a4ff-8d50-47bd-8316-c0008b7cbc88
            </code></pre>

          <pre class="wide"><code class="bash" data-trim>
$ curl -X DELETE -b cookies -c cookies \
    http://example.com/v2/veterinarians/3cfbb699-d2f2-45cd-b932-be5171887262
            </code><code class="nohilight" data-trim>
# HTTP code: 204
          </code></pre>

          <aside class="notes">
            self-documenting

            <p>no special endpoint needed; middleware can handle
              authn at any endpoint & set cookie</p>
          </aside>
        </section>

        <section id="fin">
          <h1>?</h1>
        </section>
      </div>
    </div>
    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="local/presentation.js"></script>

    <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
      controls: true,
      progress: true,
      history: true,
      center: true,

      transition: 'slide', // none/fade/slide/convex/concave/zoom

      // Optional reveal.js plugins
      dependencies: [
      { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
      { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
      { src: 'plugin/zoom-js/zoom.js', async: true },
      { src: 'plugin/notes/notes.js', async: true }
      ]
      });

    </script>

  </body>
</html>
